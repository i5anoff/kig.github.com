Slides=Klass({currentSlide:0,h1FontSize:100,h2FontSize:72,h3FontSize:60,listFontSize:48,pFontSize:48,h1Color:"white",h2Color:"white",h3Color:"white",listColor:"white",pColor:"white",h1Font:"Century Gothic,URW Gothic L,Tahoma,Arial",h2Font:"Arial",h3Font:"Arial",listFont:"Arial",pFont:"Arial",listBullet:"\u2605",pulse:0,editorWidth:520,wavyText:true,cycleColors:false,webGLCanvasID:"webgl-slides-canvas",editorID:"slides-editor",usingWebGL:false,usingHTML:false,initialize:function(c){var d=byId("editorToggle");if(d){d.parentNode.removeChild(d)}d=BUTTON("Edit",{id:"editorToggle"});d.onclick=function(){a.toggleEditMode()};this.editorToggleButton=d;document.body.insertBefore(this.editorToggleButton,c);var b=byId(this.editorID);if(b){b.parentNode.removeChild(b)}if(document.location.hash){this.currentSlide=parseInt(document.location.hash.slice(1))}else{this.currentSlide=0}var a=this;window.addEventListener("hashchange",function(){var e=parseInt(document.location.hash.slice(1));if(!isNaN(e)&&e!=this.currentSlide){a.setSlide(e)}},false);if(this.isWebGLSupported()){this.initializeWebGL(c);this.usingWebGL=true}else{if(this.isSVGSupported()){}else{window.onkeydown=this.makeKeydownHandler();this.rendererGoTo=this.htmlGoTo;this.usingHTML=true}}this.setSlideElement(c)},htmlGoTo:function(){var a=this.slideElement.getElementsByTagName("div");window.scrollTo(0,a[this.currentSlide].offsetTop-40)},isWebGLSupported:function(){return(Magi.findGLContextId(E.canvas(1,1))!=null)},isSVGSupported:function(){return false},makeKeydownHandler:function(){var b=this;var a=["BUTTON","INPUT","TEXTAREA"];return function(d){var c=d.target.tagName;if(a.indexOf(c)!=-1){return}if(Key.match(d,Key.SPACE)){if(d.shiftKey){b.previousSlide()}else{b.nextSlide()}d.preventDefault()}else{if(Key.match(d,Key.BACKSPACE)){if(d.shiftKey){b.nextSlide()}else{b.previousSlide()}d.preventDefault()}}}},initializeWebGL:function(e){document.body.style.overflow="hidden";var c=byId(this.webGLCanvasID);if(c){c.parentNode.removeChild(c)}this.canvas=E.canvas(window.innerWidth,window.innerHeight);this.canvas.setAttribute("id",this.webGLCanvasID);this.canvas.id=this.webGLCanvasID;this.canvas.setAttribute("tabindex","-1");this.canvas.style.position="absolute";this.canvas.style.left=this.canvas.style.top="0px";document.body.insertBefore(this.canvas,e);this.realDisplay=new Magi.Scene(this.canvas);this.previousFrameFBO=new Magi.FBO(this.realDisplay.gl,this.canvas.width,this.canvas.height);this.previousFrameFBO.use();this.fbo=new Magi.FBO(this.realDisplay.gl,this.canvas.width,this.canvas.height);this.fbo.use();var f=new Magi.FilterQuad();var j=this;f.addFrameListener(function(d,l){this.material.textures.Texture0=j.fbo.texture;j.display.fbo=j.fbo;j.fbo.setSize(j.canvas.width,j.canvas.height);j.display.draw(d,l);var m=j.previousFrameFBO;j.previousFrameFBO=j.fbo;j.fbo=m});this.realDisplay.scene.appendChild(f);this.display=new Magi.Scene(this.fbo);this.scene=this.display.scene;var k=this.display;k.camera.targetFov=40;k.useDefaultCameraControls(this.canvas);k.root.setX(0.02).setY(1).setAngle(-0.1);k.root.childNodes[0].setAngle(-0.05);vec3.set([0,0,8],k.camera.position);vec3.set([0,0,0],k.camera.lookAt);k.bg=[0.3,0.7,0.9,1];k.root.childNodes[0].setScale(1/200);var i=new Magi.FilterQuad(this.shaders.bgFrag);i.material.floats.aspect=4/3;k.scene.appendChild(i);byId("slides").style.display="none";k.scene.addFrameListener(function(l,m){if(j.cycleColors){var d=Magi.Colors.hsv2rgb((l/10)%360,0.9,0.7);vec3.set(d,k.bg)}});window.addEventListener("resize",function(){j.canvas.width=window.innerWidth-(j.editing?j.editorWidth:0);j.canvas.height=window.innerHeight;j.display.changed=true},false);var b=0,a=0,g=true;this.canvas.onmousedown=function(d){b=d.clientX;a=d.clientY;this.focus();g=false};this.canvas.onmousemove=function(o){if(!g){var l=o.clientX;var q=o.clientY;var n=l-b;var m=q-a;var p=Math.sqrt(n*n+m*m);if(p>5){g=true}}};this.canvas.onclick=function(d){if(!g){if(d.shiftKey){j.previousSlide()}else{j.nextSlide()}k.changed=true}g=true;d.preventDefault()};this.canvas.onkeydown=this.makeKeydownHandler();this.canvas.focus();this.targetPos=vec3.create();this.cube=this.makeCube();this.scene.appendChild(this.cube);this.rendererGoTo=this.webGLGoTo;var h=vec3.create();this.scene.addFrameListener(function(d,l){vec3.sub(j.targetPos,j.scene.position,h);if(vec3.lengthSquare(h)>1){var m=1-Math.pow(0.75,l/33);vec3.scale(h,m);vec3.add(j.scene.position,h)}else{j.visibleSlides(j.currentSlide,j.currentSlide)}vec3.negate(j.targetPos,h);vec3.sub(h,j.cube.position);var n=vec3.length(h);if(n>1){var m=1-Math.pow(0.85,l/33);vec3.scale(h,m);vec3.add(j.cube.position,h);j.cube.outerCube.setScale(Math.max(0.3,Math.min(1,100/n)));j.cube.outerCube.rotationSpeed=Math.min(50,1+n/10);if(n<80&&n>50&&j.pulse<=0){j.pulse=330}}else{j.cube.outerCube.setScale(1);j.cube.outerCube.rotationSpeed=1}if(j.pulse>0){j.cube.innerCube.setScale(0.8-(j.pulse/33)*0.02);j.pulse-=l}else{j.cube.innerCube.setScale(0.8)}})},webGLGoTo:function(a,b){vec3.negate(this.slides.childNodes[b].position,this.targetPos);this.visibleSlides(a,b)},toggleAllSlidesVisible:function(){this.allSlidesVisible=!this.allSlidesVisible;this.visibleSlides(this.currentSlide,this.currentSlide)},visibleSlides:function(e,d){if(!this.usingWebGL){return}var c=Math.min(e,d);var a=Math.max(e,d);var f=this.slides.childNodes;if(c==0&&a==f.length-1){c=f.length-1;a=0}for(var b=0;b<f.length;b++){if(!this.allSlidesVisible&&b!=c&&b!=a&&(b<c||b>a)){f[b].display=false;this.deleteTextures(f[b])}else{f[b].display=true}}},deleteTextures:function(a){a.forEach(function(d){if(d.material){for(var b in d.material.textures){if(d.material.textures[b]){d.material.textures[b].clear()}}}})},textualize:function(m,b,c){var l=[];if(b==null){b=0}switch(m.tagName){case"IMG":l.push(m.tagName+" "+m.getAttribute("src"));break;case"VIDEO":var a=m.getAttribute("src");var f=toArray(m.getElementsByTagName("source")).map(function(e){return e.getAttribute("src")});var k=(a?a+" ":"")+f.join(" ");l.push(m.tagName+" "+k);break;case"LI":var j="";for(var h=1;h<b;h++){j+="  "}l.push(j+c+" "+m.textContent);break;case"UL":c="*";b++;break;case"OL":c="#";b++;break;case"H1":case"H2":case"H3":case"P":l.push(m.tagName+" "+m.textContent);break}var d=m.childNodes;for(var h=0;h<d.length;h++){var g=this.textualize(d[h],b,c);if(g.length>0){l.push(g)}}return l.join("\n")},parseMarkup:function(k){var q=k.split("\n");var m=DIV();var o=[];for(var g=0;g<q.length;g++){var p=q[g].replace(/^\s+|\s+$/g,"");var d=p.split(" ",1)[0];var b=d.toUpperCase();var j=p.slice(b.length+1);var n=true;switch(b){case"IMG":m.appendChild(E(b,{src:j}));break;case"VIDEO":var f=j.split(" ");var h=E("VIDEO",{controls:"on"});if(f.length==1){h.setAttribute("src",f[0])}else{f.forEach(function(e){h.appendChild(E("SOURCE",{src:e}))})}m.appendChild(h);break;case"*":var c=o[o.length-1];while(o.length>0&&c.tagName!="UL"){o.pop();c=o[o.length-1]}if(o.length==0){c=UL();o.push(c);m.appendChild(c)}c.appendChild(LI(T(j)));n=false;break;case"#":var c=o[o.length-1];while(o.length>0&&c.tagName!="OL"){o.pop();c=o[o.length-1]}if(o.length==0){c=OL();o.push(c);m.appendChild(c)}c.appendChild(LI(T(j)));n=false;break;case"H1":case"H2":case"H3":case"P":m.appendChild(E(b,T(j)));break;default:var a=!(/\s/).test(p);if(a&&(/\.(jpe?g|png|gif)$/i).test(p)){m.appendChild(IMG({src:p}))}else{if(a&&(/\.(mp4|webm|og[gvm])$/i).test(p)){m.appendChild(VIDEO({src:p,controls:"on"}))}else{if(a&&(/\.(mp3|oga)$/i).test(p)){m.appendChild(AUDIO({src:p,controls:"on"}))}else{m.appendChild(E(g==0?"H1":"H2",T(p)))}}}}if(n&&o.length>0){o.splice(0)}}return m},toggleEditMode:function(){this.editing=!this.editing;if(this.editing){if(!this.editor){var a=this;this.editorButtons=DIV(BUTTON("New slide",{onclick:function(b){a.createNewSlide();b.preventDefault()}}),BUTTON("Party on!",{onclick:function(b){a.cycleColors=!a.cycleColors;b.preventDefault()}}),BUTTON("Toggle all slides visible",{style:{marginRight:"2px"},onclick:function(b){a.toggleAllSlidesVisible();b.preventDefault()}}),{style:{position:"absolute",right:"0px",bottom:"0px",width:"510px",textAlign:"right"}});this.editorSlides=DIV({style:{position:"absolute",right:"0px",top:"0px",bottom:"32px",width:"510px",overflow:"auto"}});toArray(this.slideElement.childNodes).forEach(function(d){if(!d.tagName){return}var b=TEXTAREA(T(a.textualize(d)),{onkeyup:a.textareaKeyUpHandler(d),onfocus:a.textareaFocusHandler(),});b.addEventListener("DOMNodeInserted",function(){var c=this;setTimeout(function(){c.style.height=c.scrollHeight+"px"},10)},false);a.editorSlides.appendChild(DIV(b))});this.editor=DIV(this.editorSlides,this.editorButtons,{id:this.editorID,style:{position:"fixed",right:"0px",top:"0px",bottom:"8px"}})}document.body.insertBefore(this.editor,this.slideElement);if(this.usingWebGL){this.display.camera.targetFov*=1/0.6;this.canvas.width-=this.editorWidth;this.display.changed=true}this.editorToggleButton.style.right=this.editorWidth+"px"}else{this.editor.parentNode.removeChild(this.editor);if(this.usingWebGL){this.display.camera.targetFov*=0.6;this.canvas.width+=this.editorWidth;this.display.changed=true}this.editorToggleButton.style.right="0px"}},saveSlideshow:function(){App.toggleApp();if(this.canvas){document.body.removeChild(this.canvas)}document.body.removeChild(this.editorToggleButton);if(this.editor){document.body.removeChild(this.editor)}var a=document.documentElement.innerHTML;document.body.insertBefore(this.editorToggleButton,this.slideElement);if(this.canvas){document.body.insertBefore(this.canvas,this.slideElement)}document.body.insertBefore(this.editor,this.slideElement);App.toggleApp();return a},textareaKeyUpHandler:function(b){var a=this;return(function(h){var g=this.value;if(this.previousContent==""&&Key.match(h,[Key.BACKSPACE,Key.DELETE])){var f=toArray(this.parentNode.parentNode.childNodes);a.deleteSlide(f.indexOf(this.parentNode))}else{if(h.ctrlKey&&Key.match(h,Key.ENTER)){a.createNewSlide();h.preventDefault()}else{if(this.previousContent!=g){this.style.height=this.scrollHeight+"px";this.previousContent=g;var j=a.parseMarkup(g);while(b.firstChild){b.removeChild(b.firstChild)}while(j.firstChild){var i=j.firstChild;j.removeChild(i);b.appendChild(i)}if(a.usingWebGL){var e=a.parseSlide(b);var f=toArray(this.parentNode.parentNode.childNodes);var c=f.indexOf(this.parentNode);a.replaceSlide(c,e)}}}}})},textareaFocusHandler:function(){var a=this;return(function(c){this.style.height=this.scrollHeight+"px";var b=toArray(this.parentNode.parentNode.childNodes);a.setSlide(b.indexOf(this.parentNode))})},toggleApp:function(){if(this.disabled){this.canvas.style.display="block";this.slideElement.style.display="none";this.disabled=false;this.display.paused=false}else{this.canvas.style.display="none";this.slideElement.style.display="block";this.disabled=true;this.display.paused=true}},setSlideElement:function(a){if(this.slides&&this.scene){this.scene.removeChild(this.slides);this.slideElement.style.display="block"}this.slideElement=a;this.slideCount=this.slideElement.getElementsByTagName("div").length;if(this.scene){this.slideElement.style.display="none";this.slides=this.parseSlides(a);this.scene.appendChild(this.slides)}this.setSlide(this.currentSlide)},setSlide:function(b){if(b<0){b=this.slideCount+(b%this.slideCount)}var a=this.currentSlide;this.currentSlide=b%this.slideCount;this.rendererGoTo(a,this.currentSlide);if(this.editing){var d=this.editorSlides.childNodes[this.currentSlide];d.firstChild.focus();if(this.editorSlides.scrollTop>d.offsetTop+(d.offsetHeight-50)||this.editorSlides.scrollTop+this.editorSlides.offsetHeight<d.offsetTop+50){this.editorSlides.scrollTop=d.offsetTop-50}}document.location.replace("#"+this.currentSlide)},getCurrentTitle:function(){return this.slides.childNodes[this.currentSlide].title},nextSlide:function(){this.setSlide(this.currentSlide+1)},previousSlide:function(){this.setSlide(this.currentSlide-1)},updateText:function(a,b){if(a.text!=b){a.setText(b);a.alignedNode.material.floats.xScale=a.width;a.alignedNode.material.floats.yScale=a.height}},closeEditor:function(){if(this.editor){this.editor.innerHTML="";document.body.removeChild(this.editor)}},parseSlides:function(d){var g=toArray(d.childNodes).filter(function(h){return h.tagName});var f=new Magi.Node();var b=this;var a=0;var e=g.length*400;var c=e/2*Math.PI;g.forEach(function(i){var j=a/g.length;var h=b.parseSlide(i,null,a);h.element=i;h.position[1]=Math.sin(2*Math.PI*a/10)*2500;h.position[0]=-a*10000;h.position[2]=Math.cos(2*Math.PI*a/10)*2500;a++;f.appendChild(h)});return f},repositionSlides:function(){if(this.usingWebGL){var c=this.slides.childNodes;for(var a=0;a<c.length;a++){c[a].slideIndex=a;var b=c[a].position;b[0]=-a*10000;b[1]=Math.sin(2*Math.PI*a/10)*2500;b[2]=Math.cos(2*Math.PI*a/10)*2500}}this.setSlide(this.currentSlide)},createNewSlide:function(){var h=DIV();var a=this.slideElement.childNodes;for(var d=0,b=0;d<a.length;d++){while(a[d]&&!a[d].tagName){d++}if(b==this.currentSlide){if(a[d]&&a[d].nextSibling){this.slideElement.insertBefore(h,a[d].nextSibling)}else{this.slideElement.appendChild(h)}break}if(a[d]&&a[d].tagName){b++}}if(this.usingWebGL){var f=this.parseSlide(h,null,this.currentSlide+1);this.slides.childNodes.splice(this.currentSlide+1,0,f)}if(this.editorSlides){var l=this;var c=TEXTAREA(T(l.textualize(h)),{onkeyup:l.textareaKeyUpHandler(h),onfocus:l.textareaFocusHandler(),});c.addEventListener("DOMNodeInserted",function(){var e=this;setTimeout(function(){e.style.height=e.scrollHeight+"px"},10)},false);var g=this.editorSlides.childNodes[this.currentSlide];var k=DIV(c);if(g.nextSibling){this.editorSlides.insertBefore(k,g.nextSibling)}else{this.editorSlides.appendChild(k)}}this.slideCount++;this.repositionSlides();this.setSlide(this.currentSlide+1)},deleteSlide:function(a){if(this.slideCount==1){return}if((this.currentSlide==a&&a>0)||this.currentSlide+1==this.slideCount){this.currentSlide--}this.slideCount--;if(this.editorSlides){var d=this.editorSlides.childNodes[a];d.parentNode.removeChild(d)}if(this.usingWebGL){var b=this.slides.childNodes[a];this.deleteTextures(b);this.slides.childNodes.splice(a,1);b.element.parentNode.removeChild(b.element)}this.repositionSlides()},replaceSlide:function(b,a){var d=this.slides.childNodes[b];if(!d){this.slides.appendChild(a);this.repositionSlides()}else{this.deleteTextures(d);var c=d.childNodes.splice(0);var e=a.childNodes;while(e.length>0){d.appendChild(e.shift())}}},parseSlide:function(c,e,a){var f=toArray(c.childNodes);e=e||{top:new Magi.Node(),left:0,xOffset:0,offset:0,counter:0};var b=this;var d=e.offset;f.forEach(function(o){var h;var n=e.xOffset;var m=e.offset;var i=e.left;switch(o.tagName){case"H1":sz=b.h1FontSize;if(!e.top.title){e.top.title=o.textContent}h=b.makeH1(o.textContent);e.offset+=sz*2;break;case"H2":sz=b.h2FontSize;h=b.makeH2(o.textContent);if(e.left<0){h.setAlign(h.leftAlign);i-=100}e.offset+=sz*1.5;break;case"H3":sz=b.h3FontSize;h=b.makeH3(o.textContent);e.offset+=sz*1.3;break;case"P":sz=b.pFontSize;h=new Magi.Text(o.textContent,b.pFontSize,b.pColor,b.pFont);h.setVAlign(h.topAlign);e.offset+=sz*1.3;break;case"UL":case"OL":var k=e.listType;e.listType=o.tagName;e.counter=1;e.xOffset+=32;var j=e.left;e.left=-300;b.parseSlide(o,e,a);e.left=j;e.xOffset-=32;e.listType=k;break;case"LI":var g=e.listType=="OL"?(e.counter++)+".":b.listBullet;h=new Magi.Text(g+" "+o.textContent,b.listFontSize,b.listColor,b.listFont);h.setAlign(h.leftAlign,h.topAlign);e.offset+=b.listFontSize*1.25;break;case"IMG":h=new Magi.MeshImage(o);b.addWaveShader(h,1);h.setVAlign(h.topAlign);if(!Object.isImageLoaded(o)){o.addEventListener("load",(function(q,r,l){return function(){var s=r.childNodes.indexOf(q);for(var t=s+1;t<r.childNodes.length;t++){r.childNodes[t].position[1]-=this.height-l}b.addWaveShader(q,1)}})(h,e.top,o.height),false)}e.offset+=h.height+8;break;case"CANVAS":h=new Magi.Image(o);h.setVAlign(h.topAlign);if(o.getAttribute("animated")){h.addFrameListener(function(){if(b.currentSlide==this.slideIndex){this.texture.changed=true}})}e.offset+=h.height+8;break;case"VIDEO":h=new Magi.MeshImage(o);h.alignedNode.transparent=false;b.addWaveShader(h);h.setVAlign(h.topAlign);h.elapsed=100;h.addFrameListener(function(l,q){if(b.currentSlide==this.slideIndex){if(o.paused){o.play()}if(o.currentTime!=this.currentTime){this.texture.changed=true;this.currentTime=o.currentTime}if(o.getAttribute("oncube")){b.cube.outerCube.material.textures.EmitTex=this.texture}}else{if(!o.paused){o.pause()}if(o.getAttribute("oncube")&&b.cube.outerCube.material.textures.EmitTex===this.texture){b.cube.outerCube.material.textures.EmitTex=null}}});e.offset+=h.height+8;break;case"SELF":h=new Magi.Image(b.previousFrameFBO.texture,true);h.addFrameListener(function(){this.setImage(b.previousFrameFBO.texture)});h.setVAlign(h.topAlign);e.offset+=h.height+8;break;case"MODEL":h=new Magi.Node();var p=Magi.Bin.load(o.getAttribute("src"),(function(l){return function(q){var r=1000/(q.boundingBox.diameter);var s=new Magi.Node();s.setScale(r);s.setY(-150);s.model=q.makeVBO();s.rotation.axis=[1,0,0];s.rotation.angle=-Math.PI/2;s.material=Magi.DefaultMaterial.get();s.material.floats.LightDiffuse=[1,1,1,1];s.material.floats.MaterialShininess=6;s.material.floats.MaterialDiffuse=[1,1,1,1];l.appendChild(s)}})(h));p.flatNormals=false;e.offset+=150;break}if(h){h.id=o.id;h.position[0]=i+n;h.position[1]=-m;h.slideIndex=a;e.top.appendChild(h)}});e.top.slideIndex=a;e.top.height=e.offset-d;return e.top},makeH1:function(a){var c=new Magi.MeshText(a,this.h1FontSize/3,this.h1Color,this.h1Font);c.setAlign(c.leftAlign);c.rotation.axis[0]=0.4;c.setAngle(1.2);vec3.set3(600/32,c.scaling);c.position[2]=-800;c.position[0]=-700;c.setY(120);this.addDotShader(c);var b=new Magi.Node();b.appendChild(c);return b},makeH2:function(a){var b=new Magi.MeshText(a,this.h2FontSize,this.h2Color,this.h2Font);b.setVAlign(b.topAlign);this.addWaveShader(b);return b},makeH3:function(a){var b=new Magi.MeshText(a,this.h3FontSize,this.h3Color,this.h3Font);b.setVAlign(b.topAlign);this.addWaveShader(b);return b},addDotShader:function(a){a.alignedNode.material.shader=this.getDotShader();a.alignedNode.material.floats.pitch=1;a.alignedNode.material.floats.magnitude=3;a.alignedNode.material.floats.opacity=0.2;a.alignedNode.material.floats.xScale=a.width;a.alignedNode.material.floats.yScale=a.height},addWaveShader:function(c,b){b=b||5;c.alignedNode.material.shader=this.getWaveShader();c.alignedNode.material.floats.magnitude=b;c.alignedNode.material.floats.xScale=c.width;c.alignedNode.material.floats.yScale=c.height;var a=this;c.addFrameListener(function(d,e){c.alignedNode.material.floats.time=d/500;if(a.wavyText){c.alignedNode.material.floats.magnitude=b}else{c.alignedNode.material.floats.magnitude=0}})},getDotShader:function(){if(!this.dotShader){var a=new Magi.Shader(null,this.shaders.bendVert,this.shaders.dotFrag);this.dotShader=a}return this.dotShader},getWaveShader:function(){return new Magi.Shader(null,this.shaders.waveVert,Magi.FilterMaterial.frag)},makeCube:function(){var d=new Magi.Cube();d.setAxis(0.4,0.6,-1);d.rotationSpeed=1;d.addFrameListener(function(f,g){this.rotation.angle+=(this.rotationSpeed*g/4000);this.rotation.angle%=(Math.PI*2)});d.material=d.material.copy();var c=d.material.floats;vec4.setLeft(c.MaterialDiffuse,[0.8,0.9,1,0.8]);vec4.setLeft(c.LightDiffuse,[1,1,0.5,1]);vec4.setLeft(c.LightSpecular,[0.5,1,1,1]);vec4.setLeft(c.LightAmbient,[0.3,0,0.2,1]);d.transparent=true;var b=new Magi.Cube();b.transparent=true;b.material=d.material.copy();vec4.setLeft(b.material.floats.MaterialDiffuse,[1,0.95,0.8,0.7]);var c=b.material.floats;vec4.setLeft(c.LightDiffuse,[1,1,0.8,1]);vec4.setLeft(c.LightSpecular,[1,0.95,0.8,1]);vec4.setLeft(c.LightAmbient,[0.2,0.1,0,1]);vec3.set3(0.75,b.scaling);b.blendFuncSrc="SRC_ALPHA";b.blendFuncDst="ONE";d.appendChild(b);var a=new Magi.Node();var e=new Magi.Node().setScale(250).setPosition(-800,60,-470);e.appendChild(d);a.appendChild(e);a.outerCube=d;a.innerCube=b;return a},shaders:{waveVert:{type:"VERTEX_SHADER",text:("precision mediump float;attribute vec3 Vertex;attribute vec3 Normal;attribute vec2 TexCoord;uniform mat4 PMatrix;uniform mat4 MVMatrix;uniform mat3 NMatrix;uniform float time;uniform float xScale;uniform float yScale;uniform float magnitude;varying vec2 texCoord0;void main(){  vec4 v = vec4(Vertex, 1.0);  float dx = xScale*0.03*(TexCoord.s);  float dy = yScale*0.03*(TexCoord.t-0.5);  float d = sqrt(dx*dx + dy*dy);  v.z += magnitude * (2.0*cos(time+3.14*0.1*TexCoord.s*xScale*0.03))*yScale*0.03;  texCoord0 = vec2(TexCoord.s, 1.0-TexCoord.t);  vec4 worldPos = MVMatrix * v;  gl_Position = PMatrix * worldPos;}")},bendVert:{type:"VERTEX_SHADER",text:("precision mediump float;attribute vec3 Vertex;attribute vec3 Normal;attribute vec2 TexCoord;uniform mat4 PMatrix;uniform mat4 MVMatrix;uniform mat3 NMatrix;uniform float time;uniform float xScale;uniform float yScale;uniform float magnitude;varying vec2 texCoord0;varying float z;void main(){  vec4 v = vec4(Vertex, 1.0);  float dx = xScale*0.06*(TexCoord.s);  float dy = yScale*0.06*(TexCoord.t);  float d = sqrt(dx*dx + dy*dy);  v.z += magnitude * pow(1.2,d);  texCoord0 = vec2(TexCoord.s, 1.0-TexCoord.t);  vec4 worldPos = MVMatrix * v;  gl_Position = PMatrix * worldPos;  z = gl_Position.z;}")},dotFrag:{type:"FRAGMENT_SHADER",text:("precision mediump float;uniform float xScale;uniform float yScale;uniform float opacity;uniform float pitch;uniform sampler2D Texture0;varying vec2 texCoord0;varying float z;void main(){  vec2 scale = vec2(xScale/pitch, yScale/pitch);  vec2 gridVec = texCoord0 * scale;  float gridX = floor(gridVec.s);  float gridY = floor(gridVec.t);  vec2 gridCenter = vec2((gridX + 0.5), (gridY + 0.5));  float d = length(gridVec - gridCenter);  vec4 sample = texture2D(Texture0, gridCenter / scale);  float a = sample.a;  float f = smoothstep(0.01*z+0.3*a, 0.3*a, d);  sample.a *= opacity;  sample *= f;  gl_FragColor = sample * sample.a;}")},bgFrag:{type:"FRAGMENT_SHADER",text:("precision mediump float;uniform sampler2D Texture0;uniform float aspect;varying vec2 texCoord0;void main(){  float dx = (-0.5+texCoord0.s)*1.5 * aspect;  float dy = texCoord0.t / aspect;  float d = sqrt(dx*dx + dy*dy);  vec4 c = vec4(0.76,0.72,0.78, -0.5*d);  gl_FragColor = c*c.a;}")}}});